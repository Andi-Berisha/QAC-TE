{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _createEmotion = _interopRequireDefault(require(\"create-emotion\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _AutoCenter = _interopRequireDefault(require(\"./AutoCenter\"));\n\nvar _computeScrollLeft = _interopRequireDefault(require(\"./computeScrollLeft\"));\n\nvar _createBasicStyleSet = _interopRequireDefault(require(\"./createBasicStyleSet\"));\n\nvar _createCSSKey = _interopRequireDefault(require(\"./util/createCSSKey\"));\n\nvar _FunctionContext = _interopRequireDefault(require(\"./FunctionContext\"));\n\nvar _getView = _interopRequireDefault(require(\"./getView\"));\n\nvar _InternalContext = _interopRequireDefault(require(\"./InternalContext\"));\n\nvar _LegacyContext = _interopRequireDefault(require(\"./LegacyContext\"));\n\nvar _patchStyleOptions = _interopRequireDefault(require(\"./patchStyleOptions\"));\n\nvar _PropsContext = _interopRequireDefault(require(\"./PropsContext\"));\n\nvar _useAnimateScrollLeft = _interopRequireDefault(require(\"./hooks/internal/useAnimateScrollLeft\"));\n\nvar _useCallbackRefWithSubscribe = _interopRequireDefault(require(\"./hooks/internal/useCallbackRefWithSubscribe\"));\n\nvar _useObserveScrollLeft = _interopRequireDefault(require(\"./hooks/internal/useObserveScrollLeft\"));\n\nvar _ViewContext = _interopRequireDefault(require(\"./ViewContext\"));\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n} // We pool the emotion, so we don't create a new set of <style> for every component and reuse as much as we could.\n\n\nvar emotionPool = {};\n\nvar Composer = function Composer(_ref) {\n  var children = _ref.children,\n      dir = _ref.dir,\n      height = _ref.height,\n      nonce = _ref.nonce,\n      numItems = _ref.numItems,\n      styleOptions = _ref.styleOptions,\n      styleSet = _ref.styleSet;\n  dir = dir === 'ltr' || dir === 'rtl' ? dir : undefined;\n  var patchedStyleOptions = (0, _react.useMemo)(function () {\n    return (0, _patchStyleOptions.default)(styleOptions);\n  }, [styleOptions]);\n  var patchedStyleSet = (0, _react.useMemo)(function () {\n    return styleSet || (0, _createBasicStyleSet.default)(patchedStyleOptions);\n  }, [patchedStyleOptions, styleSet]);\n  var styleSetClassNames = (0, _react.useMemo)(function () {\n    var emotion = emotionPool[nonce] || (emotionPool[nonce] = (0, _createEmotion.default)({\n      key: \"react-film--css-\".concat((0, _createCSSKey.default)()),\n      nonce: nonce\n    }));\n    return Object.fromEntries(Object.entries(patchedStyleSet).map(function (_ref2) {\n      var _ref3 = (0, _slicedToArray2.default)(_ref2, 2),\n          name = _ref3[0],\n          style = _ref3[1];\n\n      return [name, emotion.css(style) + ''];\n    }));\n  }, [nonce, patchedStyleSet]);\n\n  var _useState = (0, _react.useState)(),\n      _useState2 = (0, _slicedToArray2.default)(_useState, 2),\n      _ = _useState2[0],\n      forceRender = _useState2[1];\n\n  var itemContainerCallbackRefWithSubscribe = (0, _useCallbackRefWithSubscribe.default)();\n  var scrollableCallbackRefWithSubscribe = (0, _useCallbackRefWithSubscribe.default)();\n  var scrollLeftRef = (0, _react.useRef)(null);\n  var scrollTimeoutRef = (0, _react.useRef)();\n  (0, _react.useEffect)(function () {\n    return function () {\n      return clearTimeout(scrollTimeoutRef.current);\n    };\n  }, [scrollTimeoutRef]);\n  var scrollTo = (0, _react.useCallback)(function (scrollFn) {\n    var view = (0, _getView.default)(dir, scrollableCallbackRefWithSubscribe.current, itemContainerCallbackRefWithSubscribe.current, scrollLeftRef.current);\n\n    if (view) {\n      var index = view.index,\n          indexFraction = view.indexFraction;\n      var targetIndex = scrollFn({\n        index: index,\n        indexFraction: indexFraction\n      });\n\n      if (typeof targetIndex === 'number') {\n        scrollLeftRef.current = (0, _computeScrollLeft.default)(dir, scrollableCallbackRefWithSubscribe.current, itemContainerCallbackRefWithSubscribe.current, targetIndex);\n        forceRender({});\n      }\n    }\n  }, [dir, forceRender, itemContainerCallbackRefWithSubscribe, scrollableCallbackRefWithSubscribe, scrollLeftRef]);\n  var scrollOneLeft = (0, _react.useCallback)(function () {\n    scrollTo(function (_ref4) {\n      var indexFraction = _ref4.indexFraction;\n      return dir === 'rtl' ? Math.floor(indexFraction) + 1 : Math.ceil(indexFraction) - 1;\n    });\n  }, [dir, scrollTo]);\n  var scrollOneRight = (0, _react.useCallback)(function () {\n    scrollTo(function (_ref5) {\n      var indexFraction = _ref5.indexFraction;\n      return dir === 'rtl' ? Math.ceil(indexFraction) - 1 : Math.floor(indexFraction) + 1;\n    });\n  }, [dir, scrollTo]);\n  var functionContext = (0, _react.useMemo)(function () {\n    return {\n      scrollTo: scrollTo,\n      scrollOneLeft: scrollOneLeft,\n      scrollOneRight: scrollOneRight\n    };\n  }, [scrollTo, scrollOneLeft, scrollOneRight]);\n  var internalContext = (0, _react.useMemo)(function () {\n    return {\n      itemContainerCallbackRefWithSubscribe: itemContainerCallbackRefWithSubscribe,\n      scrollableCallbackRefWithSubscribe: scrollableCallbackRefWithSubscribe\n    };\n  }, [itemContainerCallbackRefWithSubscribe, scrollableCallbackRefWithSubscribe]);\n  var propsContext = (0, _react.useMemo)(function () {\n    return {\n      dir: dir,\n      height: height,\n      nonce: nonce,\n      numItems: numItems,\n      styleOptions: patchedStyleOptions,\n      styleSetClassNames: styleSetClassNames\n    };\n  }, [dir, height, nonce, numItems, patchedStyleOptions, styleSetClassNames]);\n\n  var _useState3 = (0, _react.useState)({\n    index: 0,\n    indexFraction: 0,\n    scrollBarPercentage: '0%',\n    scrollBarWidth: '0%',\n    scrolling: false\n  }),\n      _useState4 = (0, _slicedToArray2.default)(_useState3, 2),\n      viewContext = _useState4[0],\n      setViewContext = _useState4[1]; // This will setViewContext and reset the \"scrolling\" flag after a period of time.\n\n\n  var setViewContext2 = (0, _react.useCallback)(function (nextViewContext) {\n    setViewContext(nextViewContext);\n    clearTimeout(scrollTimeoutRef.current);\n\n    if (nextViewContext.scrolling) {\n      scrollTimeoutRef.current = setTimeout(function () {\n        return setViewContext(_objectSpread(_objectSpread({}, nextViewContext), {}, {\n          scrolling: false\n        }));\n      }, 500);\n    }\n  }, [scrollTimeoutRef, setViewContext]);\n  var handleScroll = (0, _react.useCallback)(function (_ref6) {\n    var scrollBarPercentage = _ref6.fraction,\n        initial = _ref6.initial,\n        scrollBarWidth = _ref6.width;\n    var view = (0, _getView.default)(dir, scrollableCallbackRefWithSubscribe.current, itemContainerCallbackRefWithSubscribe.current, scrollLeftRef.current);\n\n    if (view) {\n      var index = view.index,\n          indexFraction = view.indexFraction;\n      setViewContext2({\n        index: index,\n        indexFraction: indexFraction,\n        scrolling: !initial,\n        scrollBarPercentage: scrollBarPercentage,\n        scrollBarWidth: scrollBarWidth\n      });\n    }\n  }, [dir, itemContainerCallbackRefWithSubscribe, scrollableCallbackRefWithSubscribe, scrollLeftRef, setViewContext2]);\n  var handleScrollToEnd = (0, _react.useCallback)(function () {\n    scrollLeftRef.current = null;\n    forceRender({});\n  }, [forceRender, scrollLeftRef]);\n  var legacyContext = (0, _react.useMemo)(function () {\n    return _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, functionContext), internalContext), propsContext), viewContext);\n  }, [functionContext, internalContext, propsContext, viewContext]);\n  (0, _useAnimateScrollLeft.default)(typeof scrollLeftRef.current === 'number' && scrollableCallbackRefWithSubscribe.current, scrollLeftRef.current, handleScrollToEnd);\n  (0, _react.useEffect)(function () {\n    return scrollableCallbackRefWithSubscribe.subscribe(function (current) {\n      if (current) {\n        current.addEventListener('pointerdown', handleScrollToEnd, {\n          passive: true\n        });\n        return function () {\n          return current.removeEventListener('pointerdown', handleScrollToEnd);\n        };\n      }\n    });\n  }, [scrollableCallbackRefWithSubscribe]);\n  (0, _useObserveScrollLeft.default)(scrollableCallbackRefWithSubscribe, handleScroll);\n  return /*#__PURE__*/_react.default.createElement(_PropsContext.default.Provider, {\n    value: propsContext\n  }, /*#__PURE__*/_react.default.createElement(_InternalContext.default.Provider, {\n    value: internalContext\n  }, /*#__PURE__*/_react.default.createElement(_FunctionContext.default.Provider, {\n    value: functionContext\n  }, /*#__PURE__*/_react.default.createElement(_ViewContext.default.Provider, {\n    value: viewContext\n  }, /*#__PURE__*/_react.default.createElement(_LegacyContext.default.Provider, {\n    value: legacyContext\n  }, children, patchedStyleOptions.autoCenter && /*#__PURE__*/_react.default.createElement(_AutoCenter.default, null))))));\n};\n\nComposer.defaultProps = {\n  children: undefined,\n  dir: undefined,\n  height: undefined,\n  nonce: undefined,\n  styleOptions: undefined,\n  styleSet: undefined\n};\nComposer.propTypes = {\n  children: _propTypes.default.oneOfType([_propTypes.default.arrayOf(_propTypes.default.element), _propTypes.default.element]),\n  dir: _propTypes.default.oneOf(['ltr', 'rtl']),\n  height: _propTypes.default.number,\n  nonce: _propTypes.default.string,\n  numItems: _propTypes.default.number.isRequired,\n  styleOptions: _propTypes.default.any,\n  styleSet: _propTypes.default.any\n};\nvar _default = Composer;\nexports.default = _default;","map":{"version":3,"sources":["../src/Composer.js"],"names":["emotionPool","Composer","children","dir","height","nonce","numItems","styleOptions","styleSet","patchedStyleOptions","patchedStyleSet","styleSetClassNames","emotion","key","name","style","_","forceRender","itemContainerCallbackRefWithSubscribe","scrollableCallbackRefWithSubscribe","scrollLeftRef","scrollTimeoutRef","clearTimeout","scrollTo","view","index","indexFraction","targetIndex","scrollFn","scrollOneLeft","Math","scrollOneRight","functionContext","internalContext","propsContext","viewContext","setViewContext","scrollBarPercentage","scrollBarWidth","scrolling","setViewContext2","nextViewContext","setTimeout","handleScroll","fraction","initial","width","handleScrollToEnd","legacyContext","current","passive","undefined","PropTypes","any"],"mappings":"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","sourcesContent":["import createEmotion from 'create-emotion';\nimport PropTypes from 'prop-types';\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nimport AutoCenter from './AutoCenter';\nimport computeScrollLeft from './computeScrollLeft';\nimport createBasicStyleSet from './createBasicStyleSet';\nimport createCSSKey from './util/createCSSKey';\nimport FunctionContext from './FunctionContext';\nimport getView from './getView';\nimport InternalContext from './InternalContext';\nimport LegacyContext from './LegacyContext';\nimport patchStyleOptions from './patchStyleOptions';\nimport PropsContext from './PropsContext';\nimport useAnimateScrollLeft from './hooks/internal/useAnimateScrollLeft';\nimport useCallbackRefWithSubscribe from './hooks/internal/useCallbackRefWithSubscribe';\nimport useObserveScrollLeft from './hooks/internal/useObserveScrollLeft';\nimport ViewContext from './ViewContext';\n\n// We pool the emotion, so we don't create a new set of <style> for every component and reuse as much as we could.\nconst emotionPool = {};\n\nconst Composer = ({ children, dir, height, nonce, numItems, styleOptions, styleSet }) => {\n  dir = dir === 'ltr' || dir === 'rtl' ? dir : undefined;\n\n  const patchedStyleOptions = useMemo(() => patchStyleOptions(styleOptions), [styleOptions]);\n  const patchedStyleSet = useMemo(() => styleSet || createBasicStyleSet(patchedStyleOptions), [\n    patchedStyleOptions,\n    styleSet\n  ]);\n\n  const styleSetClassNames = useMemo(() => {\n    const emotion =\n      emotionPool[nonce] || (emotionPool[nonce] = createEmotion({ key: `react-film--css-${createCSSKey()}`, nonce }));\n\n    return Object.fromEntries(Object.entries(patchedStyleSet).map(([name, style]) => [name, emotion.css(style) + '']));\n  }, [nonce, patchedStyleSet]);\n\n  const [_, forceRender] = useState();\n  const itemContainerCallbackRefWithSubscribe = useCallbackRefWithSubscribe();\n  const scrollableCallbackRefWithSubscribe = useCallbackRefWithSubscribe();\n  const scrollLeftRef = useRef(null);\n  const scrollTimeoutRef = useRef();\n\n  useEffect(() => () => clearTimeout(scrollTimeoutRef.current), [scrollTimeoutRef]);\n\n  const scrollTo = useCallback(\n    scrollFn => {\n      const view = getView(\n        dir,\n        scrollableCallbackRefWithSubscribe.current,\n        itemContainerCallbackRefWithSubscribe.current,\n        scrollLeftRef.current\n      );\n\n      if (view) {\n        const { index, indexFraction } = view;\n        const targetIndex = scrollFn({ index, indexFraction });\n\n        if (typeof targetIndex === 'number') {\n          scrollLeftRef.current = computeScrollLeft(\n            dir,\n            scrollableCallbackRefWithSubscribe.current,\n            itemContainerCallbackRefWithSubscribe.current,\n            targetIndex\n          );\n          forceRender({});\n        }\n      }\n    },\n    [dir, forceRender, itemContainerCallbackRefWithSubscribe, scrollableCallbackRefWithSubscribe, scrollLeftRef]\n  );\n\n  const scrollOneLeft = useCallback(() => {\n    scrollTo(({ indexFraction }) => (dir === 'rtl' ? Math.floor(indexFraction) + 1 : Math.ceil(indexFraction) - 1));\n  }, [dir, scrollTo]);\n\n  const scrollOneRight = useCallback(() => {\n    scrollTo(({ indexFraction }) => (dir === 'rtl' ? Math.ceil(indexFraction) - 1 : Math.floor(indexFraction) + 1));\n  }, [dir, scrollTo]);\n\n  const functionContext = useMemo(\n    () => ({\n      scrollTo,\n      scrollOneLeft,\n      scrollOneRight\n    }),\n    [scrollTo, scrollOneLeft, scrollOneRight]\n  );\n\n  const internalContext = useMemo(\n    () => ({\n      itemContainerCallbackRefWithSubscribe,\n      scrollableCallbackRefWithSubscribe\n    }),\n    [itemContainerCallbackRefWithSubscribe, scrollableCallbackRefWithSubscribe]\n  );\n\n  const propsContext = useMemo(\n    () => ({ dir, height, nonce, numItems, styleOptions: patchedStyleOptions, styleSetClassNames }),\n    [dir, height, nonce, numItems, patchedStyleOptions, styleSetClassNames]\n  );\n\n  const [viewContext, setViewContext] = useState({\n    index: 0,\n    indexFraction: 0,\n    scrollBarPercentage: '0%',\n    scrollBarWidth: '0%',\n    scrolling: false\n  });\n\n  // This will setViewContext and reset the \"scrolling\" flag after a period of time.\n  const setViewContext2 = useCallback(\n    nextViewContext => {\n      setViewContext(nextViewContext);\n\n      clearTimeout(scrollTimeoutRef.current);\n\n      if (nextViewContext.scrolling) {\n        scrollTimeoutRef.current = setTimeout(\n          () =>\n            setViewContext({\n              ...nextViewContext,\n              scrolling: false\n            }),\n          500\n        );\n      }\n    },\n    [scrollTimeoutRef, setViewContext]\n  );\n\n  const handleScroll = useCallback(\n    ({ fraction: scrollBarPercentage, initial, width: scrollBarWidth }) => {\n      const view = getView(\n        dir,\n        scrollableCallbackRefWithSubscribe.current,\n        itemContainerCallbackRefWithSubscribe.current,\n        scrollLeftRef.current\n      );\n\n      if (view) {\n        const { index, indexFraction } = view;\n\n        setViewContext2({\n          index,\n          indexFraction,\n          scrolling: !initial,\n          scrollBarPercentage,\n          scrollBarWidth\n        });\n      }\n    },\n    [dir, itemContainerCallbackRefWithSubscribe, scrollableCallbackRefWithSubscribe, scrollLeftRef, setViewContext2]\n  );\n\n  const handleScrollToEnd = useCallback(() => {\n    scrollLeftRef.current = null;\n    forceRender({});\n  }, [forceRender, scrollLeftRef]);\n\n  const legacyContext = useMemo(\n    () => ({\n      ...functionContext,\n      ...internalContext,\n      ...propsContext,\n      ...viewContext\n    }),\n    [functionContext, internalContext, propsContext, viewContext]\n  );\n\n  useAnimateScrollLeft(\n    typeof scrollLeftRef.current === 'number' && scrollableCallbackRefWithSubscribe.current,\n    scrollLeftRef.current,\n    handleScrollToEnd\n  );\n\n  useEffect(\n    () =>\n      scrollableCallbackRefWithSubscribe.subscribe(current => {\n        if (current) {\n          current.addEventListener('pointerdown', handleScrollToEnd, { passive: true });\n\n          return () => current.removeEventListener('pointerdown', handleScrollToEnd);\n        }\n      }),\n    [scrollableCallbackRefWithSubscribe]\n  );\n\n  useObserveScrollLeft(scrollableCallbackRefWithSubscribe, handleScroll);\n\n  return (\n    <PropsContext.Provider value={propsContext}>\n      <InternalContext.Provider value={internalContext}>\n        <FunctionContext.Provider value={functionContext}>\n          <ViewContext.Provider value={viewContext}>\n            <LegacyContext.Provider value={legacyContext}>\n              {children}\n              {patchedStyleOptions.autoCenter && <AutoCenter />}\n            </LegacyContext.Provider>\n          </ViewContext.Provider>\n        </FunctionContext.Provider>\n      </InternalContext.Provider>\n    </PropsContext.Provider>\n  );\n};\n\nComposer.defaultProps = {\n  children: undefined,\n  dir: undefined,\n  height: undefined,\n  nonce: undefined,\n  styleOptions: undefined,\n  styleSet: undefined\n};\n\nComposer.propTypes = {\n  children: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.element), PropTypes.element]),\n  dir: PropTypes.oneOf(['ltr', 'rtl']),\n  height: PropTypes.number,\n  nonce: PropTypes.string,\n  numItems: PropTypes.number.isRequired,\n  styleOptions: PropTypes.any,\n  styleSet: PropTypes.any\n};\n\nexport default Composer;\n"]},"metadata":{},"sourceType":"script"}